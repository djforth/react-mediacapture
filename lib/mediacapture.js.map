{"version":3,"sources":["../src/mediacapture.js"],"names":[],"mappings":";;;;;AAGA,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;;AAEhC,IAAM,CAAC,GAAO,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAEhC,IAAI,WAAW,CAAC;AAChB,IAAI,KAAK,GAAG,IAAI,CAAC;AACjB,IAAI,MAAM,GAAG,CAAC,CAAC;;AAEf,IAAM,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;;;AAC/B,mBAAiB,EAAA,6BAAE;AACjB,QAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;AAC3D,QAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;GAC1D;;AAED,iBAAe,EAAA,2BAAE;AACf,WAAO;AACL,gBAAU,EAAE,IAAI;AAChB,eAAS,EAAE,EAAE;AACb,eAAS,EAAE,KAAK;KACjB,CAAC;GACH;;AAED,aAAW,EAAA,qBAAC,CAAC,EAAE;AACb,KAAC,CAAC,cAAc,EAAE,CAAC;;AAEnB,eAAW,CAAC,IAAI,EAAE,CAAC;AACnB,QAAI,CAAC,QAAQ,CAAC;AACZ,eAAS,EAAE,KAAK;KACjB,CAAC,CAAC;GACJ;;AAED,YAAU,EAAA,oBAAC,CAAC,EAAE;AACZ,KAAC,CAAC,cAAc,EAAE,CAAC;;AAEnB,aAAS,CAAC,QAAQ,CAChB;AACE,WAAK,EAAE,IAAI;AACX,WAAK,EAAE,KAAK;KACb,EACD,CAAA,UAAS,MAAM,EAAE;AACf,UAAI,CAAC,QAAQ,CAAC;AACZ,kBAAU,EAAE,IAAI;OACjB,CAAC,CAAC;;AAEH,UAAI,SAAS,CAAC,eAAe,EAAE;AAC7B,YAAI,CAAC,KAAK,CAAC,YAAY,GAAG,MAAM,CAAC;OAClC,MAAM;AACL,YAAI,SAAS,GAAG,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,SAAS,CAAC;AAC/C,YAAI,CAAC,KAAK,CAAC,GAAG,GAAG,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;OACpD;AACD,iBAAW,GAAG,MAAM,CAAC;AACrB,UAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;KACnB,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,EACZ,CAAA,UAAS,GAAG,EAAE;AACZ,UAAI,CAAC,KAAK,GAAG,GAAG,CAAC;AACjB,UAAI,CAAC,QAAQ,CAAC;AACZ,kBAAU,EAAE,KAAK;OAClB,CAAC,CAAC;;KAEJ,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CACb,CAAC;;AAEF,QAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAA,UAAS,EAAE,EAAC;AACjD,UAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;AACzB,cAAM,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,IAAI,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,KAAK,CAAA,AAAC,CAAC;;AAElE,YAAI,KAAK,CAAC,MAAM,CAAC,EAAE;AACjB,gBAAM,GAAG,KAAK,IAAI,CAAC,GAAG,CAAC,CAAA,AAAC,CAAC;SAC1B;;AAED,YAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACxC,YAAI,CAAC,KAAK,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;AAC1C,YAAI,CAAC,MAAM,CAAC,YAAY,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACzC,YAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;AAC3C,YAAI,CAAC,QAAQ,CAAC;AACZ,mBAAS,EAAE,IAAI;SAChB,CAAC,CAAC;OACJ;KACF,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;GACtB;;AAED,aAAW,EAAA,qBAAC,CAAC,EAAE;AACb,KAAC,CAAC,cAAc,EAAE,CAAC;;AAEnB,QAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;AAE3C,QAAI,KAAK,IAAI,MAAM,EAAE;AACnB,UAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;AAC1B,UAAI,CAAC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;AAC5B,aAAO,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;;AAEnD,UAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;AAC9C,UAAI,CAAC,QAAQ,CAAC;AACZ,iBAAS,EAAE,IAAI;OAChB,CAAC,CAAC;KACJ;GACF;;AAED,QAAM,EAAA,kBAAG;AACP,QAAI,QAAQ,YAAA,CAAC;AACb,QAAI,MAAM,YAAA,CAAC;;AAEX,QAAG,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE;AACnC,YAAM,GACN,+BAAO,IAAI,EAAC,QAAQ,EAAC,IAAI,EAAC,QAAQ,EAAC,KAAK,EAAC,YAAY,EAAC,SAAS,EAAC,iBAAiB,GAAS,CAAC;KAC5F;;AAED,QAAG,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;AACvB,cAAQ,GACR;;;QACE;;YAAQ,SAAS,EAAC,cAAc,EAAC,OAAO,EAAE,IAAI,CAAC,WAAW,AAAC;;SAAqB;QAChF;;YAAQ,SAAS,EAAC,cAAc,EAAC,OAAO,EAAE,IAAI,CAAC,WAAW,AAAC;;SAAoB;OAC3E,CAAC;KACR,MAAM;AACL,UAAG,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE;AACxB,gBAAQ,GACR;;;UACE;;cAAQ,SAAS,EAAC,cAAc,EAAC,OAAO,EAAE,IAAI,CAAC,UAAU,AAAC;;WAAsB;SAC5E,CAAC;OACR,MAAM;AACL,gBAAQ,GACR;;;UACE;;;;WAAsG;SAClG,CAAC;OACR;KACF;;AAED,WACE;;QAAK,SAAS,EAAC,QAAQ;MACrB;;UAAK,SAAS,EAAC,UAAU;QACvB;;YAAK,SAAS,EAAC,iBAAiB;UAC9B;;cAAO,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,AAAC;;WAEtB;SACJ;OACF;MACN;;UAAK,SAAS,EAAC,mBAAmB;QAChC,+BAAO,SAAS,EAAC,qBAAqB,EAAC,IAAI,EAAC,QAAQ,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,AAAC,EAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,AAAC,GAAG;OAC5G;MACN;;UAAK,SAAS,EAAC,UAAU;QACvB;;YAAK,SAAS,EAAC,iBAAiB;UAC9B,6BAAK,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,AAAC,GAAG;SAC9B;OACF;MACN;;UAAK,SAAS,EAAC,mBAAmB;QAChC;;YAAK,SAAS,EAAC,kBAAkB;UAC9B,QAAQ;SACL;QACL,MAAM;OACH;KACF,CACN;GACH;CACF,CAAC,CAAC;;AAEH,IAAM,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;;;AAC/B,QAAM,EAAA,kBAAG;AACP,WACE,gCAAQ,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,AAAC,GACvB,CACT;GACH;CACF,CAAC,CAAC;;AAEH,IAAM,YAAY,GAAG,KAAK,CAAC,WAAW,CAAC;;;AACrC,mBAAiB,EAAA,6BAAE;AACjB,aAAS,CAAC,QAAQ,GAChB,SAAS,CAAC,YAAY,IACtB,SAAS,CAAC,kBAAkB,IAC5B,SAAS,CAAC,eAAe,IACzB,SAAS,CAAC,cAAc,AACzB,CAAC;;AAEF,QAAI,CAAC,QAAQ,CAAC;AACZ,eAAS,EAAE,AAAC,SAAS,CAAC,QAAQ,GAAI,IAAI,GAAG,KAAK;KAC/C,CAAC,CAAC;GACJ;;AAED,iBAAe,EAAA,2BAAE;AACf,WAAO;AACL,eAAS,EAAE,KAAK;KACjB,CAAC;GACH;;AAED,QAAM,EAAA,kBAAG;AACP,QAAI,SAAS,YAAA,CAAC;;AAEd,QAAG,IAAI,CAAC,KAAK,CAAC,SAAS,EAAC;AACtB,eAAS,GACT;;UAAK,SAAS,EAAC,mBAAmB;QAChC,oBAAC,MAAM,IAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,AAAC,EAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,AAAC,EAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,AAAC,EAAC,GAAG,EAAE,CAAC,CAAC,QAAQ,EAAE,AAAC,GAAG;QAC1H,oBAAC,MAAM,IAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,AAAC,EAAC,GAAG,EAAE,CAAC,CAAC,QAAQ,EAAE,AAAC,GAAG;OACxD,CAAC;KAER,MAAM;AACL,eAAS,GACT;;;QACE;;;;SAA4G;OACxG,CAAC;KACR;;AAED,WACE;;;MACG,SAAS;KACN,CACN;GACH;CACF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,GAAG,YAAY,CAAC","file":"mediacapture.js","sourcesContent":["\n// This is adapted from https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Taking_still_photos\n\nReact = require('react/addons');\n\nconst _     = require('lodash');\n\nvar mediaStream;\nvar width = 1280;\nvar height = 0;\n\nconst Camera = React.createClass({\n  componentDidMount(){\n    this.canvas = document.getElementById(this.props.canvasID);\n    this.video = document.getElementById(this.props.videoID);\n  },\n\n  getInitialState(){\n    return {\n      has_camera: true,\n      photo_src: '',\n      streaming: false\n    };\n  },\n\n  closeCamera(e) {\n    e.preventDefault();\n\n    mediaStream.stop();\n    this.setState({\n      streaming: false\n    });\n  },\n\n  openCamera(e) {\n    e.preventDefault();\n\n    navigator.getMedia(\n      {\n        video: true,\n        audio: false\n      },\n      function(stream) {\n        this.setState({\n          has_camera: true\n        });\n\n        if (navigator.mozGetUserMedia) {\n          this.video.mozSrcObject = stream;\n        } else {\n          let vendorURL = window.URL || window.webkitURL;\n          this.video.src = vendorURL.createObjectURL(stream);\n        }\n        mediaStream = stream;\n        this.video.play();\n      }.bind(this),\n      function(err) {\n        this.error = err;\n        this.setState({\n          has_camera: false\n        });\n        // console.log('An error occured! ' + err);\n      }.bind(this)\n    );\n\n    this.video.addEventListener('canplay', function(ev){\n      if (!this.state.streaming) {\n        height = this.video.videoHeight / (this.video.videoWidth / width);\n\n        if (isNaN(height)) {\n          height = width / (4 / 3);\n        }\n\n        this.video.setAttribute('width', width);\n        this.video.setAttribute('height', height);\n        this.canvas.setAttribute('width', width);\n        this.canvas.setAttribute('height', height);\n        this.setState({\n          streaming: true\n        });\n      }\n    }.bind(this), false);\n  },\n\n  takePicture(e) {\n    e.preventDefault();\n\n    let context = this.canvas.getContext('2d');\n\n    if (width && height) {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      context.drawImage(this.video, 0, 0, width, height);\n\n      let data = this.canvas.toDataURL('image/png');\n      this.setState({\n        photo_src: data\n      });\n    }\n  },\n\n  render() {\n    let controls;\n    let submit;\n\n    if(!_.isEmpty(this.state.photo_src)) {\n      submit =\n      <input type='submit' name='commit' value='Save photo' className='btn btn-primary'></input>;\n    }\n\n    if(this.state.streaming) {\n      controls =\n      <div>\n        <button className='btn btn-info' onClick={this.closeCamera}>Stop camera</button>\n        <button className='btn btn-info' onClick={this.takePicture}>Take photo</button>\n      </div>;\n    } else {\n      if(this.state.has_camera) {\n        controls =\n        <div>\n          <button className='btn btn-info' onClick={this.openCamera}>Start camera</button>\n        </div>;\n      } else {\n        controls =\n        <div>\n          <p>Your machine does not appear to have a camera attached. Please use the form to upload an image.</p>\n        </div>;\n      }\n    }\n\n    return (\n      <div className='camera'>\n        <div className='col-md-6'>\n          <div className='media-container'>\n            <video id={this.props.videoID}>\n              Video stream not available.\n            </video>\n          </div>\n        </div>\n        <div className='form-group hidden'>\n          <input className='hidden form-control' type='hidden' value={this.state.photo_src} name={this.props.fieldName} />\n        </div>\n        <div className='col-md-6'>\n          <div className='media-container'>\n            <img src={this.state.photo_src} />\n          </div>\n        </div>\n        <div className='controls col-md-6'>\n          <div className='button-container'>\n            {controls}\n          </div>\n          {submit}\n        </div>\n      </div>\n    );\n  }\n});\n\nconst Canvas = React.createClass({\n  render() {\n    return (\n      <canvas id={this.props.canvasID}>\n      </canvas>\n    );\n  }\n});\n\nconst MediaCapture = React.createClass({\n  componentDidMount(){\n    navigator.getMedia = (\n      navigator.getUserMedia ||\n      navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia ||\n      navigator.msGetUserMedia\n    );\n\n    this.setState({\n      supported: (navigator.getMedia) ? true : false\n    });\n  },\n\n  getInitialState(){\n    return {\n      supported: false\n    };\n  },\n\n  render() {\n    let container;\n\n    if(this.state.supported){\n      container =\n      <div className='media-capture row'>\n        <Camera canvasID={this.props.canvasID} fieldName={this.props.fieldName} videoID={this.props.videoID} key={_.uniqueId()} />\n        <Canvas canvasID={this.props.canvasID} key={_.uniqueId()} />\n      </div>;\n\n    } else {\n      container =\n      <div>\n        <p>Your browser or device is not capable of using media capture. Please use the form to upload an image.</p>\n      </div>;\n    }\n\n    return (\n      <div>\n        {container}\n      </div>\n    );\n  }\n});\n\nmodule.exports = MediaCapture;\n"]}